<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Универсальный Калькулятор v2.0</title>
    
    <style>
        /* Общие стили */
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            /* На мобильных устройствах min-height: 100vh; обеспечит полный экран */
            min-height: 100vh; 
            margin: 0;
            background-color: #f0f0f0;
        }

        .calculator {
            background: #222;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            width: 100%; /* По умолчанию на 100% ширины */
            max-width: 450px; /* Ограничение на десктопе */
        }

        /* Адаптивный дизайн: Калькулятор на весь экран на мобильных устройствах */
        @media (max-width: 600px) {
            .calculator {
                border-radius: 0;
                width: 100vw;
                height: 100vh; /* Калькулятор на весь экран */
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                padding: 10px 10px 20px 10px; /* Увеличенный нижний отступ */
            }
        }

        /* Стили дисплея */
        #display {
            width: 100%;
            border: none;
            background: #333;
            color: #fff;
            font-size: 3.5em; /* Увеличенный размер шрифта */
            text-align: right;
            padding: 20px 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            overflow-x: auto; /* Для длинных чисел/выражений */
            white-space: nowrap;
        }

        /* Стили для переключения режимов */
        #mode-select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 1em;
            background: #444;
            color: white;
            border: none;
            border-radius: 5px;
        }
        
        /* Стили кнопок */
        .buttons {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(4, 1fr);
            flex-grow: 1; /* На мобильных устройствах займет доступное место */
        }

        .buttons button {
            padding: 20px 10px; /* Увеличенный padding для пальцев */
            font-size: 1.5em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background-color: #555;
            color: #fff;
            transition: background-color 0.1s;
        }

        .buttons button:hover {
            background-color: #777;
        }

        /* Стиль для операторов */
        .operator {
            background-color: #ff9f0a;
            color: white;
        }

        .operator:hover {
            background-color: #ffb84d;
        }

        /* Стиль для специальных функций (AC, =) */
        .special {
            background-color: #a5a5a5;
            color: black;
        }
        
        .special.equal {
            background-color: #10c93c;
            color: white;
            font-weight: bold;
        }

        /* Стиль для научных/программистских функций */
        .function-btn {
            background-color: #444;
            color: #ccc;
            font-size: 1em;
        }
    </style>
</head>
<body>

    <div class="calculator">
        <select id="mode-select" onchange="changeMode(this.value)">
            <option value="basic">Базовый</option>
            <option value="scientific">Научный</option>
            <option value="programmer">Программистский</option>
        </select>

        <input type="text" id="display" readonly value="0">
        
        <div class="buttons" id="calc-buttons">
            </div>
    </div>

    <script>
        const display = document.getElementById('display');
        const buttonsContainer = document.getElementById('calc-buttons');
        const modeSelect = document.getElementById('mode-select');

        let currentMode = 'basic';

        // --- ДАННЫЕ О РЕЖИМАХ И КНОПКАХ ---
        
        const modes = {
            basic: [
                { text: 'AC', class: 'special', action: 'clear' },
                { text: '+/-', class: 'special', action: 'sign' },
                { text: '%', class: 'special', action: 'percent' },
                { text: '/', class: 'operator', action: 'append' },

                { text: '7', class: '', action: 'append' },
                { text: '8', class: '', action: 'append' },
                { text: '9', class: '', action: 'append' },
                { text: '*', class: 'operator', action: 'append' },

                { text: '4', class: '', action: 'append' },
                { text: '5', class: '', action: 'append' },
                { text: '6', class: '', action: 'append' },
                { text: '-', class: 'operator', action: 'append' },

                { text: '1', class: '', action: 'append' },
                { text: '2', class: '', action: 'append' },
                { text: '3', class: '', action: 'append' },
                { text: '+', class: 'operator', action: 'append' },

                { text: '0', class: '', action: 'append', style: 'grid-column: span 2;' },
                { text: '.', class: '', action: 'append' },
                { text: '=', class: 'special equal', action: 'calculate' }
            ],
            scientific: [
                { text: '(', class: 'function-btn', action: 'append' },
                { text: ')', class: 'function-btn', action: 'append' },
                { text: 'sin', class: 'function-btn', action: 'mathFunc' },
                { text: 'cos', class: 'function-btn', action: 'mathFunc' },
                
                { text: 'AC', class: 'special', action: 'clear' },
                { text: 'log', class: 'function-btn', action: 'mathFunc' },
                { text: 'exp', class: 'function-btn', action: 'mathFunc' },
                { text: '/', class: 'operator', action: 'append' },

                { text: '7', class: '', action: 'append' },
                { text: '8', class: '', action: 'append' },
                { text: '9', class: '', action: 'append' },
                { text: '*', class: 'operator', action: 'append' },
                
                { text: '4', class: '', action: 'append' },
                { text: '5', class: '', action: 'append' },
                { text: '6', class: '', action: 'append' },
                { text: '-', class: 'operator', action: 'append' },

                { text: '1', class: '', action: 'append' },
                { text: '2', class: '', action: 'append' },
                { text: '3', class: '', action: 'append' },
                { text: '+', class: 'operator', action: 'append' },

                { text: '0', class: '', action: 'append' },
                { text: '.', class: '', action: 'append' },
                { text: 'π', class: 'function-btn', action: 'pi' },
                { text: '=', class: 'special equal', action: 'calculate' }
            ],
            programmer: [
                { text: 'BIN', class: 'function-btn', action: 'base' },
                { text: 'HEX', class: 'function-btn', action: 'base' },
                { text: 'DEC', class: 'function-btn', action: 'base' },
                { text: 'AC', class: 'special', action: 'clear' },

                { text: 'A', class: 'function-btn disabled', action: 'append' }, // Для HEX
                { text: 'B', class: 'function-btn disabled', action: 'append' },
                { text: 'C', class: 'function-btn disabled', action: 'append' },
                { text: 'OR', class: 'operator', action: 'append' },

                { text: 'D', class: 'function-btn disabled', action: 'append' },
                { text: 'E', class: 'function-btn disabled', action: 'append' },
                { text: 'F', class: 'function-btn disabled', action: 'append' },
                { text: 'AND', class: 'operator', action: 'append' },

                { text: '1', class: '', action: 'append' },
                { text: '0', class: '', action: 'append' },
                { text: 'XOR', class: 'operator', action: 'append' },
                { text: '=', class: 'special equal', action: 'calculate' }
            ]
        };

        // --- ЛОГИКА КАЛЬКУЛЯТОРА ---

        function appendValue(value) {
            const current = display.value;
            // Убираем начальный '0'
            if (current === '0' && !isNaN(value)) {
                display.value = value;
            } else if (current === '0' && (value === '.' || isOperator(value))) {
                display.value += value;
            } else {
                display.value += value;
            }
        }

        function isOperator(char) {
            return ['+', '-', '*', '/'].includes(char);
        }

        function clearDisplay() {
            display.value = '0';
        }

        function calculateResult() {
            try {
                let expression = display.value.replace(/×/g, '*').replace(/÷/g, '/');
                
                // В зависимости от режима, здесь нужна разная логика парсинга/вычисления
                if (currentMode === 'scientific') {
                    // Используем Math для sin, cos, log и т.д.
                    expression = expression
                        .replace(/sin\(([^)]+)\)/g, (match, p1) => `Math.sin(${eval(p1)})`)
                        .replace(/cos\(([^)]+)\)/g, (match, p1) => `Math.cos(${eval(p1)})`)
                        .replace(/log\(([^)]+)\)/g, (match, p1) => `Math.log10(${eval(p1)})`);
                } else if (currentMode === 'programmer') {
                    // Здесь будет логика для побитовых операций (AND, OR, XOR)
                    // Для простоты, пока оставим обычное eval, но в реальном калькуляторе
                    // нужно парсить операнды и выполнять побитовые операции.
                }

                // ВАЖНО: eval() небезопасен, но для простого примера в одном файле HTML
                // без сторонних библиотек он используется для демонстрации.
                let result = eval(expression);
                // Округление для избежания ошибок с плавающей запятой
                display.value = parseFloat(result.toFixed(10));
            } catch (e) {
                display.value = 'Ошибка';
            }
        }
        
        function handleSpecial(action) {
            switch (action) {
                case 'clear':
                    clearDisplay();
                    break;
                case 'sign':
                    if (display.value !== '0' && display.value !== 'Ошибка') {
                        // Простое переключение знака текущего числа (если оно одно)
                        display.value = String(eval(display.value) * -1);
                    }
                    break;
                case 'percent':
                    if (display.value !== '0' && display.value !== 'Ошибка') {
                         display.value = String(eval(display.value) / 100);
                    }
                    break;
            }
        }
        
        function handleMathFunc(func) {
            // Добавляем функцию с открывающей скобкой
            if (display.value === '0') {
                 display.value = `${func}(`;
            } else {
                 display.value += `${func}(`;
            }
        }

        function handlePi() {
            // Добавляем число Пи
             if (display.value === '0') {
                 display.value = `${Math.PI}`;
            } else {
                 display.value += `${Math.PI}`;
            }
        }

        function handleBaseConvert(base) {
            // Логика конвертации для Программистского режима
            if (display.value === '0' || display.value === 'Ошибка') return;

            const decValue = parseInt(display.value, currentBase); // currentBase нужно отслеживать
            
            if (isNaN(decValue)) {
                display.value = 'Ошибка';
                return;
            }
            
            switch(base) {
                case 'BIN':
                    display.value = decValue.toString(2);
                    // Здесь нужно обновить состояние кнопок (0 и 1 активны)
                    break;
                case 'HEX':
                    display.value = decValue.toString(16).toUpperCase();
                    // Здесь нужно обновить состояние кнопок (0-9, A-F активны)
                    break;
                case 'DEC':
                    display.value = decValue.toString(10);
                    // Здесь нужно обновить состояние кнопок (0-9 активны)
                    break;
            }
        }

        // --- ЛОГИКА РЕЖИМОВ И ГЕНЕРАЦИЯ КНОПОК ---

        function generateButtons(mode) {
            buttonsContainer.innerHTML = ''; // Очищаем старые кнопки
            
            const layout = modes[mode];
            
            layout.forEach(btn => {
                const button = document.createElement('button');
                button.innerText = btn.text;
                button.className = btn.class || '';
                
                // Добавляем стиль, если указан (например, для 0)
                if (btn.style) {
                    button.style.cssText = btn.style;
                }

                // Добавляем обработчик событий
                button.addEventListener('click', () => {
                    if (btn.action === 'append') {
                        appendValue(btn.text);
                    } else if (btn.action === 'calculate') {
                        calculateResult();
                    } else if (btn.action === 'clear' || btn.action === 'sign' || btn.action === 'percent') {
                        handleSpecial(btn.action);
                    } else if (btn.action === 'mathFunc') {
                        handleMathFunc(btn.text + '(');
                    } else if (btn.action === 'pi') {
                        handlePi();
                    } else if (btn.action === 'base') {
                        handleBaseConvert(btn.text);
                    }
                });
                
                buttonsContainer.appendChild(button);
            });
            // Настройка сетки для Программистского режима (3 столбца)
            if (mode === 'programmer') {
                buttonsContainer.style.gridTemplateColumns = 'repeat(4, 1fr)';
            } else {
                buttonsContainer.style.gridTemplateColumns = 'repeat(4, 1fr)';
            }
        }
        
        function changeMode(mode) {
            currentMode = mode;
            display.value = '0';
            generateButtons(mode);
            // На десктопе сохраняем обычный вид, на мобиле - полный экран.
            // Это уже обрабатывается CSS-медиазапросами.
        }

        // Инициализация при загрузке
        window.onload = () => {
            changeMode(modeSelect.value); // Загружаем Базовый режим по умолчанию
        };

    </script>

</body>
</html>
