<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS Webview</title>
    <style>
        /* Удаляем все элементы UI, оставляем только сам веб-контент */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: #ffffff; 
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
        }
        
        .webview-frame {
            width: 100%;
            height: 100vh; /* Занимает всю высоту видимой области */
            border: none;
            background: white;
            display: block;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #3498db;
        }
    </style>
</head>
<body>
    <iframe id="webviewFrame" class="webview-frame" 
            sandbox="allow-scripts allow-forms allow-same-origin allow-popups">
    </iframe>

    <div id="loadingMessage" class="loading">Загрузка...</div>

    <script src="api.js"></script> 
    <script>
        const webviewFrame = document.getElementById('webviewFrame');
        const loadingMessage = document.getElementById('loadingMessage');

        /**
         * Извлекает адрес сайта из window.location.hash
         */
        function extractSiteUrlFromHash() {
            const hash = window.location.hash; 
            
            if (hash.length > 1) {
                return hash.substring(1); 
            }
            
            return 'welcome.vs';
        }

        /**
         * Глобальная функция навигации, требуемая api.js
         */
        window.navigateTo = async function(url) {
            loadingMessage.style.display = 'block';

            try {
                // Используем функцию loadWebsite из api.js
                const content = await loadWebsite(url);
                
                webviewFrame.srcdoc = content;
                document.title = url + ' | VS Webview'; // Обновляем заголовок
                
                // КРИТИЧЕСКОЕ ИСПРАВЛЕНИЕ: Обновляем хэш URL-адреса
                // Это меняет видимый адрес в строке браузера
                window.history.pushState(null, null, `#${url}`); 

            } catch (error) {
                webviewFrame.srcdoc = `
                    <div style="padding: 50px; text-align: center; color: #e74c3c;">
                        <h2>❌ Ошибка загрузки</h2>
                        <p>Сайт: ${url}</p>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                loadingMessage.style.display = 'none';
            }
        }

        // Запуск: При загрузке страницы извлекаем URL из хэша и переходим
        window.onload = function() {
            const siteUrl = extractSiteUrlFromHash();
            console.log('Detected site URL from hash:', siteUrl);
            navigateTo(siteUrl);
            
            // Обработка перехода по кнопкам "назад/вперед" браузера
            window.onhashchange = function() {
                const newUrl = extractSiteUrlFromHash();
                // Используем navigateTo для загрузки нового сайта, но только если хэш изменился
                // (чтобы избежать двойной загрузки при использовании pushState)
                if (newUrl !== extractSiteUrlFromHash()) { 
                    navigateTo(newUrl);
                }
            };
        };
    </script>
</body>
</html>
